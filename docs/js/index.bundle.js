!function(){"use strict";let e=[];const t="HABBIT_KEY";let n;const o=document.querySelector(".add-habbit"),s={menu:document.querySelector(".panel__nav-list"),header:{title:document.querySelector(".content__title"),deleteHabbitButton:document.querySelector(".content__delete-habbit-button"),progressBar:{progressBarWrapper:document.querySelector(".progress-bar"),progressCounter:document.querySelector(".progress-bar__counter"),progressDone:document.querySelector(".progress-bar__done")}},main:{habbitsContainer:document.getElementById("days"),nextDay:document.querySelector(".habbit__day")}};function a(){localStorage.setItem(t,JSON.stringify(e))}function i(e,t){for(const n of t)e[n].value=""}function r(e,t){const n=new FormData(e),o={};for(const s of t){const t=n.get(s);if(e[s].classList.remove("input--error"),!t)return void e[s].classList.add("input--error");o[s]=t}let s=!0;for(const e of t)o[e]||(s=!1);if(s)return o}function d(t){s.menu.innerHTML="";for(const n of e){const e=document.querySelector(`[menu-habbit-id="${n.id}"]`);if(e)t.id===n.id?e.classList.add("habbit-button--active"):e.classList.remove("habbit-button--active");else{const e=document.createElement("button");e.setAttribute("menu-habbit-id",n.id),e.classList.add("habbit-button","panel__habbit-button"),e.addEventListener("click",(()=>c(n.id))),e.innerHTML=`<span class="visually-hidden">Habbit</span>\n                <svg class="icon icon--${n.icon}">\n                    <use href="./img/svgsprite/sprite.symbol.svg#${n.icon}"></use>\n                </svg>`,t.id===n.id&&e.classList.add("habbit-button--active"),s.menu.appendChild(e)}}}function c(t){if(n=t,!t)return s.header.title.innerText="У вас нет привычек!",s.header.deleteHabbitButton.classList.add("none"),s.header.progressBar.progressBarWrapper.classList.add("none"),s.menu.classList.add("none"),o.classList.add("none"),void d();document.location.replace(document.location.pathname+"#"+t);const a=e.find((e=>e.id===t));d(a),function(e){s.header.title.innerText=e.name;const t=e.days.length/e.target>1?100:e.days.length/e.target*100;s.header.progressBar.progressCounter.innerText=t.toFixed(0)+"%",s.header.progressBar.progressDone.style.width=t.toFixed(0)+"%"}(a),function(e){s.main.habbitsContainer.innerHTML="";for(const t in e.days){const n=document.createElement("div");n.classList.add("habbit"),n.innerHTML=`<div class="habbit__day">День ${Number(t)+1}</div>\n        <h2 class="habbit__title">${e.days[t].comment}</h2>\n        <button class="habbit__delete-button delete-button" onclick="deleteDay(${t})">\n            <span class="visually-hidden">Delete day ${t}</span>\n            <svg class="icon icon--delete">\n                <use href="./img/svgsprite/sprite.symbol.svg#delete"></use>\n            </svg>\n        </button>`,s.main.habbitsContainer.appendChild(n)}s.main.nextDay.innerHTML=`День ${e.days.length+1}`}(a),e.length>0&&(s.menu.classList.remove("none"),s.header.deleteHabbitButton.classList.remove("none"),s.header.progressBar.progressBarWrapper.classList.remove("none"),o.classList.remove("none"))}function u(t){e=e.map((e=>e.id===n?(e.days.splice(t,1),{...e,days:e.days}):e)),c(n),a()}function l(){document.querySelector(".cover").classList.toggle("none")}function b(e,t){document.querySelector('.popup__form input[name="icon"]').value=t,document.querySelector(".popup__habbit-button.habbit-button--active").classList.remove("habbit-button--active"),e.classList.add("habbit-button--active")}function m(){const t=e.findIndex((e=>e.id===n));-1!==t&&(e.splice(t,1),a(),e.length>0?c(n-1):c())}document.querySelector(".add-habbit__form").addEventListener("submit",(function(t){t.preventDefault();const o=r(t.target,["comment"]);o&&(e=e.map((e=>e.id===n?{...e,days:e.days.concat([{comment:o.comment}])}:e)),i(t.target,["comment"]),c(n),a())})),document.querySelector(".popup__form").addEventListener("submit",(function(t){t.preventDefault();const n=r(t.target,["name","icon","target"]);if(!n)return;const o=e.reduce(((e,t)=>e>t.id?e:t.id),0);e.push({id:o+1,icon:n.icon,name:n.name,target:n.target,days:[]}),i(t.target,["name","target"]),l(),c(o+1),a()})),(()=>{if(function(){const n=localStorage.getItem(t),o=JSON.parse(n);Array.isArray(o)&&(e=o)}(),window.habbits=e,window.page=s,window.deleteDay=u,window.togglePopup=l,window.setIcon=b,window.deleteHabbit=m,e.length>0){const t=Number(document.location.hash.replace("#","")),n=e.find((e=>e.id===t));c(n?n.id:e[0].id)}0===e.length&&(s.header.deleteHabbitButton.classList.add("none"),s.header.progressBar.progressBarWrapper.classList.add("none"),s.menu.classList.add("none"),o.classList.add("none"))})()}();